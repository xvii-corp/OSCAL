<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../build/metaschema-xslt/src/validate/metaschema-composition-check.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!-- <!DOCTYPE METASCHEMA [
  <!ENTITY allowed-values-responsible-roles-system SYSTEM "./shared-constraints/allowed-values-responsible-roles-system.ent">
  <!ENTITY allowed-values-responsible-roles-operations SYSTEM "./shared-constraints/allowed-values-responsible-roles-operations.ent">
  <!ENTITY allowed-values-responsible-roles-component-production SYSTEM "./shared-constraints/allowed-values-responsible-roles-component-production.ent">
]>
-->
<METASCHEMA xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0"
  xsi:schemaLocation="http://csrc.nist.gov/ns/oscal/metaschema/1.0 ../../build/metaschema-xslt/support/metaschema/schema/xml/metaschema.xsd"
  abstract="yes">
  <schema-name>OSCAL Shared Responsibility Format -- Common Modules</schema-name>
  <schema-version>1.1.2</schema-version>
  <short-name>oscal-responsibility-common</short-name>
  <namespace>http://csrc.nist.gov/ns/oscal/1.0</namespace>
  <json-base-uri>http://csrc.nist.gov/ns/oscal</json-base-uri>
  <remarks>
    <p>This contains all modules common to shared responsibility in the ssp and component definition
      models. </p>
  </remarks>

  <!-- IMPORT STATEMENTS -->
  <import href="oscal_metadata_metaschema.xml" />
  <import href="oscal_implementation-common_metaschema.xml" />

  <!-- Shared Responsibility Assemblies -->
  <!-- ASSEMBLY DEFINITIONS -->
  <define-assembly name="source-ssp">
    <formal-name>Source SSP</formal-name>
    <description>The leveraged System Security Plan (SSP) that documents the components implementing
      inheritable controls.</description>
    <!-- While it is desirable for the SSP of the system to be in OSCAL, legacy systems might not
    have one, and the SR would serve as the first step towards digitalization. The `ssp-uuid` will not be
    required -->
    <flag ref="ssp-uuid" required="no" />
    <!-- should an SR be created from another SR? 
    <flag ref="sr-uuid" required="no" /> -->

    <model>
      <define-field name="title" as-type="markup-line">
        <formal-name>Source Title</formal-name>
        <description>The title of sourced leveraged SSP.</description>
      </define-field>

      <define-field name="published" as-type="date-time-with-timezone">
        <formal-name>Publication Timestamp</formal-name>
        <description>The time and date of leveraged SSP initial publication.</description>
      </define-field>

      <define-field name="last-modified" as-type="date-time-with-timezone">
        <formal-name>Last Modified Timestamp</formal-name>
        <description>The time and date of leveraged SSP last modification.</description>
      </define-field>

      <define-field name="version">
        <formal-name>Document Version</formal-name>
        <description>The version of the leveraged SSP.</description>
      </define-field>

      <field ref="date-authorized" />
      <field ref="party-uuid" min-occurs="1" />

      <assembly ref="referenced-profile" max-occurs="1" />

      <assembly ref="property" max-occurs="unbounded">
        <group-as name="props" in-json="ARRAY" />
      </assembly>

      <assembly ref="link" max-occurs="unbounded">
        <group-as name="links" in-json="ARRAY" />
      </assembly>

      <field ref="remarks" in-xml="WITH_WRAPPER" />
    </model>

  </define-assembly>

  <define-assembly name="referenced-profile">
    <formal-name>Referenced Profile</formal-name>
    <description>The OSCAL profile imported by the leveraged SSP.</description>
    <define-flag name="href" as-type="uri-reference" required="yes">
      <formal-name>Hyperlink Reference</formal-name>
      <description>A link to a resource that defines a set of components and/or capabilities to
        import into this collection.</description>
      <remarks>
        <p>This value may be one of:</p>
        <ol>
          <li>an <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#absolute-uri">absolute URI</a>
            that points to a network resolvable resource,</li>
          <li>a <a href="https://pages.nist.gov/OSCAL/concepts/uri-use/#relative-reference">relative
            reference</a> pointing to a network resolvable resource whose base URI is the URI of the
            containing document, or</li>
          <li>a bare URI fragment (i.e., `#uuid`) pointing to a <code>back-matter</code> resource in
            this or an imported document (see <a
              href="https://pages.nist.gov/OSCAL/concepts/uri-use/#linking-to-another-oscal-object">linking
            to another OSCAL object</a>).</li>
        </ol>
      </remarks>
    </define-flag>
  </define-assembly>

  <define-assembly name="provided">
    <formal-name>Provided Control Implementation</formal-name>
    <description>Describes a capability provided by a component of the leveraged system which may be inherited by a leveraging system.</description>
    <!-- CHANGED: "provided-group" to "provided" -->
    <!-- <group-as name="provided" in-json="ARRAY"/> -->
    <define-flag name="uuid" as-type="uuid" required="yes">
      <formal-name>Provided Universally Unique Identifier</formal-name>
      <!-- Identifier Declaration -->
      <description>A <a
          href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">
        machine-oriented</a>, <a
          href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally
        unique</a> identifier with <a
          href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a>
        scope that can be used to reference this provided entry elsewhere in <a
          href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#ssp-identifiers">this or other
        OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>provided</code> entry
        can be used to reference the data item locally or globally (e.g., in an imported OSCAL
        instance). This UUID should be assigned <a
          href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>,
        which means it should be consistently used to identify the same subject across revisions of
        the document.</description>
    </define-flag>
    <flag ref="implemented-by" required="no" />
    <flag ref="exportable" />

    <model>
      <define-field name="description" as-type="markup-multiline" min-occurs="1"
        in-xml="WITH_WRAPPER">
        <formal-name>Provided Control Implementation Description</formal-name>
        <description>An implementation statement that describes the aspects of the control or control statement implementation that can be provided to another system leveraging this system.</description>
      </define-field>
      <assembly ref="property" max-occurs="unbounded">
        <group-as name="props" in-json="ARRAY" />
      </assembly>
      <assembly ref="link" max-occurs="unbounded">
        <group-as name="links" in-json="ARRAY" />
        <!-- TODO: Model specific link relationships -->
      </assembly>
      <assembly ref="responsible-role" min-occurs="0" max-occurs="unbounded">
        <group-as name="responsible-roles" in-json="ARRAY" />
      </assembly>
      <field ref="remarks" in-xml="WITH_WRAPPER" />
    </model>
    <constraint>
      <is-unique id="unique-provided-responsible-role" target="responsible-role">
        <key-field target="@role-id" />
        <remarks>
          <p>Since <code>responsible-role</code> associates multiple <code>party-uuid</code> entries with a single <code>role-id</code>, each role-id must be referenced only once.</p>
        </remarks>
      </is-unique>
    </constraint>
  </define-assembly>

  <define-assembly name="responsibility">
    <formal-name>Control Implementation Responsibility</formal-name>
    <description>Describes a control implementation responsibility imposed on a leveraging system.</description>
    <!-- <group-as name="responsibilities" in-json="ARRAY"/> -->
    <define-flag name="uuid" as-type="uuid" required="yes">
      <formal-name>Responsibility Universally Unique Identifier</formal-name>
      <!-- Identifier Declaration -->
      <description>A <a
          href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">
        machine-oriented</a>, <a
          href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally
        unique</a> identifier with <a
          href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a>
        scope that can be used to reference this responsibility elsewhere in <a
          href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#ssp-identifiers">this or other
        OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>responsibility</code>
        can be used to reference the data item locally or globally (e.g., in an imported OSCAL
        instance). This UUID should be assigned <a
          href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>,
        which means it should be consistently used to identify the same subject across revisions of
        the document.</description>
    </define-flag>
    <flag ref="provided-uuid" required="no" />
    <!-- Identifying the implementer of an inheritable control for which a responsibility exists can be done through provided-uuid.
    <flag ref="implemented-by" required="no" />
    -->
    <flag ref="exportable" />
    <model>
      <define-field name="description" as-type="markup-multiline" min-occurs="1"
        in-xml="WITH_WRAPPER">
        <formal-name>Control Implementation Responsibility Description</formal-name>
        <description>An implementation statement that describes the aspects of the control or
          control statement implementation that a leveraging system must implement to satisfy the
          control provided by a leveraged system.</description>
      </define-field>
      <assembly ref="property" max-occurs="unbounded">
        <group-as name="props" in-json="ARRAY" />
      </assembly>
      <assembly ref="link" max-occurs="unbounded">
        <group-as name="links" in-json="ARRAY" />
        <!-- TODO: Model specific link relationships -->
      </assembly>
      <assembly ref="responsible-role" min-occurs="0" max-occurs="unbounded">
        <group-as name="responsible-roles" in-json="ARRAY" />
        <remarks>
          <p>A role defined at the by-component level takes precedence over the same role defined on
            the parent implemented-requirement or on the referenced component. </p>
        </remarks>
      </assembly>
      <field ref="remarks" in-xml="WITH_WRAPPER" />
    </model>
    <constraint>
      <is-unique id="unique-responsibility-responsible-role" target="responsible-role">
        <key-field target="@role-id" />
        <remarks>
          <p>Since <code>responsible-role</code> associates multiple <code>party-uuid</code> entries
            with a single <code>role-id</code>, each role-id must be referenced only once.</p>
        </remarks>
      </is-unique>
    </constraint>
  </define-assembly>

  <define-assembly name="inherited">
    <formal-name>Inherited Control Implementation</formal-name>
    <description>Describes a control implementation inherited by a leveraging system.</description>
    <!-- CHANGED: "inherited-group" to "inherited" -->
    <!-- <group-as name="inherited" in-json="ARRAY"/> -->
    <define-flag name="uuid" as-type="uuid" required="yes">
      <formal-name>Inherited Universally Unique Identifier</formal-name>
      <!-- Identifier Declaration -->
      <description>A <a
          href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">
        machine-oriented</a>, <a
          href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally
        unique</a> identifier with <a
          href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a>
        scope that can be used to reference this inherited entry elsewhere in <a
          href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#ssp-identifiers">this or other
        OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>inherited control
        implementation</code> can be used to reference the data item locally or globally (e.g., in
        an imported OSCAL instance). This UUID should be assigned <a
          href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>,
        which means it should be consistently used to identify the same subject across revisions of
        the document.</description>
    </define-flag>
    <flag ref="provided-uuid" required="no" />
    <flag ref="implemented-by" required="no" />
    <flag ref="exportable" />

    <model>
      <define-field name="description" as-type="markup-multiline" min-occurs="1"
        in-xml="WITH_WRAPPER">
        <formal-name>Inherited Control Implementation Description</formal-name>
        <description>An implementation statement that describes the aspects of a control or control
          statement implementation that a leveraging system is inheriting from a leveraged system.</description>
      </define-field>
      <assembly ref="property" max-occurs="unbounded">
        <group-as name="props" in-json="ARRAY" />
      </assembly>
      <assembly ref="link" max-occurs="unbounded">
        <group-as name="links" in-json="ARRAY" />
        <!-- TODO: Model specific link relationships -->
      </assembly>
      <assembly ref="responsible-role" min-occurs="0" max-occurs="unbounded">
        <group-as name="responsible-roles" in-json="ARRAY" />
      </assembly>
    </model>
    <constraint>
      <is-unique id="unique-inherited-responsible-role" target="responsible-role">
        <key-field target="@role-id" />
        <remarks>
          <p>Since <code>responsible-role</code> associates multiple <code>party-uuid</code> entries
            with a single <code>role-id</code>, each role-id must be referenced only once.</p>
        </remarks>
      </is-unique>
    </constraint>
  </define-assembly>

  <define-assembly name="satisfied">
    <formal-name>Satisfied Control Implementation Responsibility</formal-name>
    <description>Describes how this system satisfies a responsibility imposed by a leveraged system.</description>
    <!-- CHANGED: "satisfied-group" to "satisfied" -->
    <!-- <group-as name="satisfied" in-json="ARRAY"/> -->
    <define-flag name="uuid" as-type="uuid" required="yes">
      <formal-name>Satisfied Universally Unique Identifier</formal-name>
      <!-- Identifier Declaration -->
      <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">
        machine-oriented</a>, <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally
        unique</a> identifier with <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a>
        scope that can be used to reference this satisfied control implementation entry elsewhere in <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#ssp-identifiers">this or other
        OSCAL instances</a>. The locally defined <em>UUID</em> of the <code>control implementation</code> can be used to reference the data item locally or globally (e.g., in an imported OSCAL
        instance). This UUID should be assigned <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#consistency">per-subject</a>, which means it should be consistently used to identify the same subject across revisions of the document.</description>
    </define-flag>
    <flag ref="responsibility-uuid" required="no" />
    <flag ref="inherited-uuid" required="no" />
    <flag ref="exportable" />
    <model>
      <define-field name="description" as-type="markup-multiline" min-occurs="1"
        in-xml="WITH_WRAPPER">
        <formal-name>Satisfied Control Implementation Responsibility Description</formal-name>
        <description>An implementation statement that describes the aspects of a control or control
          statement implementation that a leveraging system is implementing based on a requirement
          from a leveraged system.</description>
      </define-field>
      <assembly ref="property" max-occurs="unbounded">
        <group-as name="props" in-json="ARRAY" />
      </assembly>
      <assembly ref="link" max-occurs="unbounded">
        <group-as name="links" in-json="ARRAY" />
        <!-- TODO: Model specific link relationships -->
      </assembly>
      <assembly ref="responsible-role" min-occurs="0" max-occurs="unbounded">
        <group-as name="responsible-roles" in-json="ARRAY" />
      </assembly>
      <field ref="remarks" in-xml="WITH_WRAPPER" />
    </model>
    <constraint>
      <is-unique id="unique-satisfied-responsible-role" target="responsible-role">
        <key-field target="@role-id" />
        <remarks>
          <p>Since <code>responsible-role</code> associates multiple <code>party-uuid</code> entries
            with a single <code>role-id</code>, each role-id must be referenced only once.</p>
        </remarks>
      </is-unique>
    </constraint>
  </define-assembly>

  <define-assembly name="export" deprecated="1.1.0">
    <formal-name>Shared Responsibility</formal-name>
    <description>Identifies content intended for external consumption, such as with leveraged
      organizations, customer responsibility documentation, and shared security responsibility
      documentation.</description>

    <model>
      <!-- Not clear why exportable flag in an export assembly would be needed. It did not exist
      anyway.
        <flag ref="exportable" /> 
      -->
      <define-field name="description" as-type="markup-multiline" in-xml="WITH_WRAPPER">
        <formal-name>Control Implementation Export Description</formal-name>
        <description>An implementation statement that describes the aspects of the control or
          control statement implementation that can be available to another system leveraging this
          system.</description>
      </define-field>
      <assembly ref="property" max-occurs="unbounded">
        <group-as name="props" in-json="ARRAY" />
      </assembly>
      <assembly ref="link" max-occurs="unbounded">
        <group-as name="links" in-json="ARRAY" />
        <!-- TODO: Model specific link relationships -->
      </assembly>
      <assembly ref="provided" max-occurs="unbounded">
        <group-as name="provided" in-json="ARRAY" />
      </assembly>
      <assembly ref="responsibility" max-occurs="unbounded">
        <group-as name="responsibilities" in-json="ARRAY" />
      </assembly>
      <field ref="remarks" in-xml="WITH_WRAPPER" />
    </model>

    <constraint>
      <has-cardinality target="provided|responsibility" min-occurs="1" />
      <index name="shared-responsibility-provided-uuid" target="//shared-responsibility/provided">
        <key-field target="@uuid" />
      </index>

      <index-has-key name="shared-responsibility-provided-uuid" target="responsibility">
        <key-field target="@provided-uuid" />
      </index-has-key>
    </constraint>
  </define-assembly>

  <!-- FLAG DEFINITIONS -->
  <define-flag name="ssp-uuid" as-type="uuid" >
    <formal-name>SSP Universally Unique Identifier</formal-name>
    <description>A <a
        href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">
      machine-oriented</a>, <a
        href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally
      unique</a> identifier with <a
        href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a>
      scope that can be used to reference the sourced SSP in <a
        href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#scope">this or other OSCAL
      instances</a>.</description>
  </define-flag>

  <define-flag name="sr-uuid" as-type="uuid" >
    <formal-name>SR Universally Unique Identifier</formal-name>
    <description>A <a
        href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">
      machine-oriented</a>, <a
        href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally
      unique</a> identifier with <a
        href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a>
      scope that can be used to reference the Shared Responsibility leveraged in <a
        href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#scope">this or other OSCAL
      instances</a>.</description>
  </define-flag>

  <define-flag name="provided-uuid" as-type="uuid" scope="local">
    <formal-name>Provided UUID</formal-name>
    <!-- Identifier Reference -->
    <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">
      machine-oriented</a> identifier reference to an inheritable control implementation that a
      leveraging system may inherite from a leveraged system.</description>
  </define-flag>

  <define-flag name="implemented-by" as-type="uuid">
    <formal-name>Implementer UUID</formal-name>
    <!-- Identifier Reference -->
    <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">
      machine-oriented</a>, <a
      href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#globally-unique">globally
    unique</a> identifier with <a
      href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#cross-instance">cross-instance</a>
    scope that is used to reference the party responsible for the implemented capability or control. An inheritable
      capability or control provided by a leveraged system can be inherited by a leveraging system and further
      provided to leveraging system's customers. The entity responsible for implementing the control is often
       rederred to as the “Control Originator”.</description>
  </define-flag>

  <define-flag name="responsibility-uuid" as-type="uuid" scope="local">
    <formal-name>Responsibility UUID</formal-name>
    <!-- Identifier Reference -->
    <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">
      machine-oriented</a> identifier reference to a control implementation that satisfies a
      responsibility imposed by a leveraged system.</description>
  </define-flag>

  <define-flag name="inherited-uuid" as-type="uuid" scope="local">
    <formal-name>Inherited UUID</formal-name>
    <!-- Identifier Reference -->
    <description>A <a href="https://pages.nist.gov/OSCAL/concepts/identifier-use/#machine-oriented">
      machine-oriented</a> identifier reference to the control inherited by the leveraging system
      from the leveraged system. The satisfaction of the inherited control might depend on the
      responsibilities by the leveraging system and must be satisfied by either the leveraging system 
      or be further passed on as customer responsibilities. The flag binds the inherited control information 
      with this control information.</description>
  </define-flag>

  <!-- FIELDS -->
  <!-- <define-field name="date-authorized" as-type="date" scope="local">
    <formal-name>System Authorization Date</formal-name>
    <description>The date the system received its most recent authorization to operate.</description>
  </define-field> -->

</METASCHEMA>